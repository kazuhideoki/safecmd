# SafeCmd - 安全な rm コマンドの設計仕様書

## 1. プロジェクト概要

SafeCmdは、従来の`rm`コマンドの代替として設計された安全なファイル削除ツールです。内部的に`trash`コマンドを使用することで、誤削除を防ぎ、削除したファイルの復元を可能にします。

## 2. 設計思想

### 2.1 基本原則

- **安全第一**: 重要なファイルの誤削除を防ぐ
- **透過的な動作**: 通常の`rm`コマンドと同じインターフェースを提供
- **復元可能性**: 削除したファイルをゴミ箱から復元可能
- **保護機能**: システムファイルや重要なファイルの削除を制限

### 2.2 動作モード

- **デフォルトモード**: ファイルをゴミ箱に移動
- **強制削除モード**: 特定のオプションで完全削除を許可（要確認）
- **ドライランモード**: 削除対象のプレビュー機能

## 3. 主要機能

### 3.1 基本機能

- `rm`コマンドと互換性のあるインターフェース
- ファイル・ディレクトリの削除（ゴミ箱への移動）
- 複数ファイルの一括削除
- ワイルドカード対応

### 3.2 安全機能

- **保護リスト機能**
  - システムファイルの削除防止
  - `.gitignore`パターンの尊重
  - カスタム保護リストの設定

- **確認機能**
  - 複数ファイル削除時の確認プロンプト
  - 大容量ファイル削除時の警告
  - 重要ディレクトリ削除時の二重確認

- **ログ機能**
  - 削除操作の履歴記録
  - 復元用メタデータの保存

### 3.3 拡張機能

- **設定ファイル**
  - `.safecmdrc`による設定カスタマイズ
  - プロジェクト固有の`.safecmd`ファイル対応

- **除外設定**
  - `.allowsafecmd`ファイルによる削除許可リスト
  - `.denysafecmd`ファイルによる削除禁止リスト

## 4. 技術仕様

### 4.1 実装言語

- Rust（高速性と安全性を重視）

### 4.2 依存関係

- `trash`コマンド（macOS: `trash`、Linux: `trash-cli`）
- 標準ライブラリのみを使用（最小限の依存）

### 4.3 コマンドラインインターフェース

```bash
safecmd [OPTIONS] [FILES...]

OPTIONS:
  -r, --recursive    ディレクトリを再帰的に削除
  -f, --force        確認なしで削除
  -i, --interactive  削除前に確認
  -v, --verbose      詳細な出力
  -n, --dry-run      実行内容のプレビュー
  --version          バージョン情報を表示
  --help             ヘルプを表示
```

### 4.4 設定ファイル形式

#### グローバル設定 (`~/.safecmdrc`)
```toml
[general]
default_mode = "trash"  # trash, delete
confirm_threshold = 10  # ファイル数がこれ以上の場合確認

[protection]
system_files = true
git_ignored = true
custom_patterns = [
  "*.key",
  "*.pem",
  "node_modules/**",
  ".env*"
]

[logging]
enabled = true
path = "~/.safecmd/logs"
```

## 5. 実装計画

### フェーズ1: 基本機能
1. 基本的な`rm`互換インターフェース
2. `trash`コマンドとの統合
3. 基本的なオプション対応

### フェーズ2: 安全機能
1. 保護リストの実装
2. 確認プロンプトの実装
3. ログ機能の実装

### フェーズ3: 拡張機能
1. 設定ファイル対応
2. プロジェクト固有設定
3. 高度なパターンマッチング

## 6. テスト戦略

- ユニットテスト: 各機能の個別テスト
- 統合テスト: `trash`コマンドとの連携テスト
- シナリオテスト: 実使用ケースのテスト
- 安全性テスト: 保護機能の動作確認

## 7. 今後の拡張案

- GUI版の開発
- クラウドバックアップ連携
- 削除履歴の可視化ツール
- 他のシェルとの統合（zsh、fish等）